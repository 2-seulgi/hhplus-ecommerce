# 사용자 스토리 (User Stories)

## 포인트 관리

### US-PNT-01: 포인트 잔액 조회
**As a** 사용자
**I want** 내 포인트 잔액을 조회하고 싶다
**So that** 결제 가능 여부를 확인할 수 있다

**Acceptance Criteria:**
- [ ] 사용자는 본인의 현재 포인트 잔액을 조회할 수 있어야 한다
- [ ] 포인트 내역이 없는 신규 사용자는 잔액 0으로 응답받는다
- [ ] 응답 시간은 100ms 이내여야 한다

---

### US-PNT-02: 포인트 충전
**As a** 사용자
**I want** 포인트를 충전하고 싶다
**So that** 상품을 구매할 수 있다

**Acceptance Criteria:**
- [ ] 최소 1,000원, 최대 1,000,000원까지 충전 가능하다
- [ ] 충전 후 즉시 잔액에 반영된다
- [ ] 충전 내역이 포인트 히스토리에 기록된다 (type=CHARGE)
- [ ] 충전 성공 시 변경된 잔액을 응답받는다

---

### US-PNT-03: 포인트 내역 조회
**As a** 사용자
**I want** 포인트 사용/충전 내역을 조회하고 싶다
**So that** 포인트 변동 내역을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 최신순으로 페이징 조회가 가능하다 (기본 20개)
- [ ] 각 내역에는 type(CHARGE/USE/REFUND), 금액, 잔액, 일시가 포함된다
- [ ] 본인의 내역만 조회할 수 있다

---

## 상품 관리

### US-PRD-01: 상품 목록 조회
**As a** 사용자
**I want** 상품 목록을 조회하고 싶다
**So that** 구매할 상품을 찾을 수 있다

**Acceptance Criteria:**
- [ ] 페이징 처리가 가능하다 (page, size 파라미터)
- [ ] 각 상품의 기본 정보(ID, 이름, 가격, 재고)를 확인할 수 있다
- [ ] 전체 개수와 다음 페이지 존재 여부를 응답받는다

---

### US-PRD-02: 상품 상세 조회
**As a** 사용자
**I want** 상품 상세 정보를 조회하고 싶다
**So that** 구매 결정을 내릴 수 있다

**Acceptance Criteria:**
- [ ] 상품의 모든 정보(ID, 이름, 가격, 재고, 설명)를 확인할 수 있다
- [ ] 존재하지 않는 상품 조회 시 404 에러를 반환한다

---

### US-PRD-03: 인기 상품 조회
**As a** 사용자
**I want** 최근 3일간 판매량 기준 Top5 상품을 보고 싶다
**So that** 인기 있는 상품을 빠르게 찾을 수 있다

**Acceptance Criteria:**
- [ ] 최근 3일간 판매량 기준으로 정렬된다
- [ ] 최대 5개까지 조회된다
- [ ] 각 상품의 판매 수량이 함께 표시된다

---

## 장바구니 관리

### US-CART-01: 장바구니 담기
**As a** 사용자
**I want** 상품을 장바구니에 담고 싶다
**So that** 나중에 한 번에 주문할 수 있다

**Acceptance Criteria:**
- [ ] 상품 ID와 수량을 지정하여 담을 수 있다
- [ ] 이미 담긴 상품은 수량이 증가한다
- [ ] 장바구니에 담긴 후 즉시 반영된다

---

### US-CART-02: 장바구니 조회
**As a** 사용자
**I want** 장바구니 목록을 조회하고 싶다
**So that** 담아둔 상품을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니에 담긴 모든 상품을 조회할 수 있다
- [ ] 각 상품의 현재 재고 상태(AVAILABLE/OUT_OF_STOCK)가 표시된다
- [ ] 상품 정보(이름, 가격)와 담은 수량이 표시된다

---

### US-CART-03: 장바구니 삭제
**As a** 사용자
**I want** 장바구니에서 상품을 삭제하고 싶다
**So that** 구매하지 않을 상품을 제거할 수 있다

**Acceptance Criteria:**
- [ ] 특정 상품을 장바구니에서 삭제할 수 있다
- [ ] 삭제 후 즉시 반영된다
- [ ] 존재하지 않는 항목 삭제 시 404 에러를 반환한다

---

### US-CART-04: 장바구니 수량 변경
**As a** 사용자
**I want** 장바구니 상품의 수량을 변경하고 싶다
**So that** 구매 수량을 조절할 수 있다

**Acceptance Criteria:**
- [ ] 특정 상품의 수량을 변경할 수 있다
- [ ] 수량을 0으로 변경하면 장바구니에서 삭제된다
- [ ] 변경 후 즉시 반영된다

---

## 주문 관리

### US-ORD-01: 주문 생성
**As a** 사용자
**I want** 장바구니 상품으로 주문을 생성하고 싶다
**So that** 결제를 진행할 수 있다

**Acceptance Criteria:**
- [ ] 장바구니가 비어있으면 주문을 생성할 수 없다 (400 에러)
- [ ] 재고가 부족한 상품이 있으면 주문을 생성할 수 없다 (409 에러)
- [ ] 주문 생성 시 상태는 PENDING, 만료 시간은 30분 후로 설정된다
- [ ] 주문 생성 시 상품 정보(가격, 수량)가 스냅샷으로 저장된다
- [ ] 주문 번호를 응답받는다

---

### US-ORD-02: 주문 내역 조회
**As a** 사용자
**I want** 내 주문 내역을 조회하고 싶다
**So that** 주문 상태를 확인할 수 있다

**Acceptance Criteria:**
- [ ] 본인의 모든 주문을 최신순으로 조회할 수 있다
- [ ] 각 주문의 상태(PENDING/CONFIRMED/CANCELLED/REFUNDED)가 표시된다
- [ ] 주문에 포함된 상품 목록과 총 금액이 표시된다

---

## 결제 관리

### US-PAY-01: 주문 결제
**As a** 사용자
**I want** 생성한 주문을 결제하고 싶다
**So that** 상품을 구매할 수 있다

**Acceptance Criteria:**
- [ ] PENDING 상태이고 만료되지 않은 주문만 결제할 수 있다
- [ ] 쿠폰을 선택적으로 사용할 수 있다
- [ ] 결제 프로세스는 다음 순서로 진행된다:
  1. 쿠폰 검증 (선택 시)
  2. 재고 차감 (낙관적 락)
  3. 할인 계산
  4. 포인트 차감
  5. 쿠폰 사용 처리
  6. 주문 확정 (CONFIRMED)
  7. Outbox 이벤트 기록
- [ ] 재고 부족 시 409 에러를 반환하고 트랜잭션을 롤백한다
- [ ] 포인트 부족 시 402 에러를 반환하고 트랜잭션을 롤백한다
- [ ] 쿠폰이 유효하지 않으면 409 에러를 반환한다
- [ ] 결제 성공 시 주문 상태가 CONFIRMED로 변경된다

---

### US-PAY-02: 주문 환불
**As a** 사용자
**I want** 결제 완료된 주문을 환불하고 싶다
**So that** 구매를 취소할 수 있다

**Acceptance Criteria:**
- [ ] CONFIRMED 상태의 주문만 환불할 수 있다
- [ ] 환불 시 다음이 자동으로 처리된다:
  - 포인트 복원 (type=REFUND)
  - 재고 복원
  - 쿠폰 복원 (유효기간 내인 경우)
- [ ] Idempotency-Key로 중복 환불을 방지한다
- [ ] 환불 성공 시 주문 상태가 REFUNDED로 변경된다

---

## 쿠폰 관리

### US-CPN-01: 선착순 쿠폰 발급
**As a** 사용자
**I want** 선착순 쿠폰을 발급받고 싶다
**So that** 할인 혜택을 받을 수 있다

**Acceptance Criteria:**
- [ ] 발급 수량이 남아있는 쿠폰만 발급받을 수 있다
- [ ] 동시 요청 시 낙관적 락으로 정합성을 보장한다
- [ ] 이미 발급받은 쿠폰은 중복 발급되지 않는다 (409 에러)
- [ ] 발급 수량이 모두 소진되면 409 에러를 반환한다
- [ ] 발급 성공 시 쿠폰 정보를 응답받는다

---

### US-CPN-02: 보유 쿠폰 조회
**As a** 사용자
**I want** 내가 보유한 쿠폰을 조회하고 싶다
**So that** 사용 가능한 쿠폰을 확인할 수 있다

**Acceptance Criteria:**
- [ ] 본인이 발급받은 모든 쿠폰을 조회할 수 있다
- [ ] 사용 가능한 쿠폰만 필터링할 수 있다 (used=false, 유효기간 내)
- [ ] 각 쿠폰의 할인 정보와 사용 여부가 표시된다
