## :pushpin: PR μ λ©
[STEP05] λ μ΄μ–΄λ“ μ•„ν‚¤ν…μ² κΈ°λ° μ΄μ»¤λ¨Έμ¤ μ„λΉ„μ¤ κµ¬ν„

---
## β οΈ **μ¤‘μ”: μ΄λ² κ³Όμ λ” DBλ¥Ό μ‚¬μ©ν•μ§€ μ•μµλ‹λ‹¤**
> λ¨λ“  λ°μ΄ν„°λ” **μΈλ©”λ¨λ¦¬(ConcurrentHashMap)**λ΅ κ΄€λ¦¬ν–μµλ‹λ‹¤.
> μ‹¤μ  DB μ—°λ™μ€ λ‹¤μ μ±•ν„°(λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„)μ—μ„ μ§„ν–‰ μμ •μ…λ‹λ‹¤.

---
## π“‹ **κ³Όμ  μ²΄ν¬λ¦¬μ¤νΈ**

### β… **STEP 5: λ μ΄μ–΄λ“ μ•„ν‚¤ν…μ² κΈ°λ³Έ κµ¬ν„** (ν•„μ)
- [x] **λ„λ©”μΈ λ¨λΈ κµ¬ν„**: Entity, Value Objectκ°€ μ •μλμ—λ”κ°€?
  - User, Product, Order, OrderItem, Coupon, UserCoupon, Point, Cart, OrderDiscount
- [x] **μ μ¤μΌ€μ΄μ¤ κµ¬ν„**: API λ…μ„Έκ°€ μ μ¤μΌ€μ΄μ¤λ΅ κµ¬ν„λμ—λ”κ°€?
  - ν¬μΈνΈ, μƒν’, μ¥λ°”κµ¬λ‹, μ£Όλ¬Έ, μΏ ν° μ „μ²΄ API κµ¬ν„ μ™„λ£
- [x] **λ μ΄μ–΄λ“ μ•„ν‚¤ν…μ²**: 4κ³„μΈµ(Presentation, Application, Domain, Infrastructure)μΌλ΅ λ¶„λ¦¬λμ—λ”κ°€?
  - λ„λ©”μΈλ³„ ν¨ν‚¤μ§€ λ‚΄ Controller-Service-Domain-Infrastructure κ³„μΈµ λ¶„λ¦¬
- [x] **μ¬κ³  κ΄€λ¦¬**: μ¬κ³  μ΅°ν/μ°¨κ°/λ³µκµ¬ λ΅μ§μ΄ κµ¬ν„λμ—λ”κ°€?
  - Product.decreaseStock(), increaseStock() κµ¬ν„
  - λ‚™κ΄€μ  λ½(@Version) μ¤€λΉ„
- [x] **μ£Όλ¬Έ/κ²°μ **: μ£Όλ¬Έ μƒμ„± λ° κ²°μ  ν”„λ΅μ„Έμ¤κ°€ κµ¬ν„λμ—λ”κ°€?
  - μ£Όλ¬Έ μƒμ„±, κ²°μ , ν™λ¶, μ·¨μ† μ „μ²΄ νλ¦„ κµ¬ν„
  - μΏ ν° ν• μΈ μ μ©, ν¬μΈνΈ μ°¨κ°, μ¬κ³  μ°¨κ° νΈλμ­μ… μ²λ¦¬
- [x] **μ„ μ°©μ μΏ ν°**: μΏ ν° λ°κΈ‰/μ‚¬μ©/λ§λ£ λ΅μ§μ΄ κµ¬ν„λμ—λ”κ°€?
  - λ°κΈ‰ μλ‰ μ ν•, μ¤‘λ³µ λ°κΈ‰ λ°©μ§€, μ‚¬μ© κΈ°κ°„ κ²€μ¦
- [x] **λ‹¨μ„ ν…μ¤νΈ**: ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ 70% μ΄μƒ λ‹¬μ„±ν–λ”κ°€?
  - **53% λ‹¬μ„±** (μ„λΉ„μ¤ λ μ΄μ–΄ ν‰κ·  89%, Controller 0%)
  - 92κ° ν…μ¤νΈ ν†µκ³Ό

### π”¥ **STEP 6: λ™μ‹μ„± μ μ–΄ λ° κ³ κΈ‰ κΈ°λ¥** (μ‹¬ν™”)
- [ ] **λ™μ‹μ„± μ μ–΄**: μ„ μ°©μ μΏ ν° λ°κΈ‰μ Race Conditionμ΄ λ°©μ§€λμ—λ”κ°€?
  - λ‚™κ΄€μ  λ½(@Version) μ μ© μ¤€λΉ„
  - ConcurrentHashMap μ‚¬μ©
- [ ] **ν†µν•© ν…μ¤νΈ**: λ™μ‹μ„± μ‹λ‚λ¦¬μ¤λ¥Ό κ²€μ¦ν•λ” ν…μ¤νΈκ°€ μ‘μ„±λμ—λ”κ°€?
  - λ―Έμ‘μ„± (STEP 6 μ‹¬ν™” κ³Όμ )
- [x] **μΈκΈ° μƒν’ μ§‘κ³„**: μ΅°νμ/νλ§¤λ‰ κΈ°λ° μμ„ κ³„μ‚°μ΄ κµ¬ν„λμ—λ”κ°€?
  - μµκ·Ό 3μΌκ°„ νλ§¤λ‰ κΈ°μ¤€ μƒμ„ 5κ° μ΅°ν
- [x] **λ¬Έμ„ν™”**: README.mdμ— λ™μ‹μ„± μ μ–΄ λ¶„μ„μ΄ μ‘μ„±λμ—λ”κ°€?
  - μ•„ν‚¤ν…μ² μ„¤κ³„ κ³ λ―Ό, νΈλ μ΄λ“μ¤ν”„ λ¶„μ„ ν¬ν•¨

### π—οΈ **μ•„ν‚¤ν…μ² μ„¤κ³„**
- [x] **μμ΅΄μ„± λ°©ν–¥**: Domain β† Application β† Infrastructure λ°©ν–¥μ΄ μ§€μΌμ΅λ”κ°€?
  - Serviceκ°€ Domainκ³Ό Repository μΈν„°νμ΄μ¤μ—λ§ μμ΅΄
- [x] **μ±…μ„ λ¶„λ¦¬**: κ° κ³„μΈµμ μ±…μ„μ΄ λ…ν™•ν λ¶„λ¦¬λμ—λ”κ°€?
  - Controller: μ”μ²­/μ‘λ‹µ λ³€ν™
  - Service: λΉ„μ¦λ‹μ¤ λ΅μ§ μ΅°μ¨
  - Domain: ν•µμ‹¬ λΉ„μ¦λ‹μ¤ κ·μΉ™
  - Infrastructure: λ°μ΄ν„° μ €μ¥μ†
- [x] **ν…μ¤νΈ κ°€λ¥μ„±**: Mock/Stubμ„ ν™μ©ν• ν…μ¤νΈκ°€ κ°€λ¥ν• κµ¬μ΅°μΈκ°€?
  - Repository MockμΌλ΅ Service ν…μ¤νΈ μ‘μ„±
  - Clock μ£Όμ…μΌλ΅ μ‹κ°„ μμ΅΄μ  λ΅μ§ ν…μ¤νΈ
- [x] **μΈλ©”λ¨λ¦¬ μ €μ¥μ†**: DB μ—†μ΄ λ¨λ“  λ°μ΄ν„°κ°€ μΈλ©”λ¨λ¦¬λ΅ κ΄€λ¦¬λλ”κ°€?
  - ConcurrentHashMap κΈ°λ° InMemory*Repository κµ¬ν„
- [x] **Repository ν¨ν„΄**: μΈν„°νμ΄μ¤μ™€ μΈλ©”λ¨λ¦¬ κµ¬ν„μ²΄κ°€ λ¶„λ¦¬λμ—λ”κ°€?
  - λ¨λ“  Repositoryκ°€ μΈν„°νμ΄μ¤ + InMemory κµ¬ν„μ²΄λ΅ λ¶„λ¦¬

---
## π”— **μ£Όμ” κµ¬ν„ μ»¤λ°‹**

### κΈ°λ° κµ¬μ΅°
- Clock μ„¤μ •: `b2398c7`
- JaCoCo μ»¤λ²„λ¦¬μ§€ ν”λ¬κ·ΈμΈ: `853828c`

### λ„λ©”μΈ & μΈν”„λΌ
- Coupon μΈν”„λΌ: `81fc58b`
- UserCoupon μ „μ²΄ κµ¬ν„: `1d4d87e`
- OrderDiscount μΈν”„λΌ: `6dce9e8`

### Order λ„λ©”μΈ (κ²°μ /ν™λ¶/μ·¨μ†)
- Order API κµ¬ν„: `b7deb7e`
- OrderService λΉ„μ¦λ‹μ¤ λ΅μ§: `38434e4`

### ν…μ¤νΈ
- OrderService & CouponService ν…μ¤νΈ: `c2a4e7b`
  - OrderServicePaymentTest: 6κ°
  - OrderServiceRefundCancelTest: 9κ°
  - CouponServiceTest: 8κ°

### λ¦¬ν©ν† λ§ & λ¬Έμ„ν™”
- Controller/Service DTO λ¶„λ¦¬: `d8ad72b`
- README μ‘μ„±: `797cf69`

---
## π’¬ **λ¦¬λ·° μ”μ²­ μ‚¬ν•­**

### μ§λ¬Έ/κ³ λ―Ό ν¬μΈνΈ
1. **DTO λ¶„λ¦¬μ ν•„μ”μ„±**: Controller DTOμ™€ Service DTOλ¥Ό λ¶„λ¦¬ν–λ”λ°, μ΄κΈ° μ½”λ“λ‰μ΄ μ¦κ°€ν•λ” λ‹¨μ μ΄ μμµλ‹λ‹¤. μ΄ μ •λ„ κ·λ¨μ ν”„λ΅μ νΈμ—μ„ λ¶„λ¦¬κ°€ μ μ ν•μ§€ μκ²¬ λ¶€νƒλ“λ¦½λ‹λ‹¤.
2. **λ‚™κ΄€μ  λ½ vs λΉ„κ΄€μ  λ½**: μ¬κ³  μ°¨κ°κ³Ό ν¬μΈνΈ μ‚¬μ©μ— λ‚™κ΄€μ  λ½μ„ μ„ νƒν–λ”λ°, μ¶©λμ΄ λΉλ²ν• κ²½μ° μ„±λ¥ μ €ν•κ°€ μ°λ ¤λ©λ‹λ‹¤. λΉ„κ΄€μ  λ½μ΄ λ” λ‚μ„κΉμ”?

### νΉλ³„ν λ¦¬λ·°λ°›κ³  μ‹¶μ€ λ¶€λ¶„
- **λ„λ©”μΈλ³„ ν¨ν‚¤μ§€ κµ¬μ΅°**: κ³„μΈµλ³„ ν¨ν‚¤μ§€ λ€μ‹  λ„λ©”μΈλ³„λ΅ κµ¬μ„±ν–λ”λ°, μ¥λ‹¨μ μ— λ€ν• ν”Όλ“λ°± λ¶€νƒλ“λ¦½λ‹λ‹¤.
- **Clock μ£Όμ… λ°©μ‹**: μ‹κ°„ μ²λ¦¬λ¥Ό μ„ν•΄ Clockμ„ μ£Όμ…ν–λ”λ°, λ” λ‚μ€ λ°©λ²•μ΄ μμ„κΉμ”?
- **νΈλμ­μ… μ²λ¦¬ μμ„**: OrderService.processPayment()μ νΈλμ­μ… μμ„κ°€ μ μ ν•μ§€ ν™•μΈ λ¶€νƒλ“λ¦½λ‹λ‹¤.

---
## π“ **ν…μ¤νΈ λ° ν’μ§**

| ν•­λ© | κ²°κ³Ό |
|------|------|
| ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ | 53% (μ„λΉ„μ¤ λ μ΄μ–΄ ν‰κ·  89%) |
| λ‹¨μ„ ν…μ¤νΈ | 92κ° ν†µκ³Ό |
| ν†µν•© ν…μ¤νΈ | 0κ° (Controller λ μ΄μ–΄ λ―Έν…μ¤νΈ) |
| λ™μ‹μ„± ν…μ¤νΈ | λ―Έμ‘μ„± (STEP 6 μ‹¬ν™”) |

### λ„λ©”μΈλ³„ μ»¤λ²„λ¦¬μ§€

| λ„λ©”μΈ | μ»¤λ²„λ¦¬μ§€ |
|--------|----------|
| CartService | 91% |
| PointService | 100% |
| ProductService | 91% |
| CouponService | 93% |
| OrderService | 72% |

### μ»¤λ²„λ¦¬μ§€ 70% λ―Έλ‹¬ μ΄μ 
Controller λ μ΄μ–΄(0%)μ™€ DTO ν΄λμ¤λ“¤μ΄ ν…μ¤νΈλμ§€ μ•μ•„ μ „μ²΄ μ»¤λ²„λ¦¬μ§€κ°€ 53%μ…λ‹λ‹¤.
**μ„λΉ„μ¤ λ μ΄μ–΄λ” μ¶©λ¶„ν• ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€(89%)λ¥Ό ν™•λ³΄**ν–μµλ‹λ‹¤.

---
## π”’ **λ™μ‹μ„± μ μ–΄ λ°©μ‹** (STEP 6 ν•„μ)

**μ„ νƒν• λ°©μ‹:**
- [x] Atomic Operations (λ‚™κ΄€μ  λ½ @Version)
- [x] ConcurrentHashMap

**κµ¬ν„ μ΄μ :**
1. **λ‚™κ΄€μ  λ½(@Version)**
   - μ½κΈ° μ„±λ¥ μ°μ (Lock λ€κΈ° μ—†μ)
   - μ‹¤μ  μ¶©λ λ°μƒ μ‹μ—λ§ μμ™Έ λ°μƒ
   - JPA μ „ν™ μ‹ νΈν™μ„±

2. **ConcurrentHashMap**
   - λ©€ν‹°μ¤λ λ“ ν™κ²½μ—μ„ μ•μ „ν• CRUD
   - HashMap λ€λΉ„ μ•½κ°„μ μ¤λ²„ν—¤λ“λ΅ λ™μ‹μ„± μ§€μ›

μ¶”κ°€ κ°λ° ν•„μ”... μ‚¬μ‹¤μƒ μ¤€λΉ„λ§ ν•΄λ‘” μƒνƒλ΅ μ‹¤μ§μ μΈ λ™μ‹μ„± μ μ–΄ μ—†μ

**μ μ© λ€μƒ:**
- Product.decreaseStock() / increaseStock()
- User.use() / charge()
- Coupon.incrementIssuedQuantity()

**νΈλ μ΄λ“μ¤ν”„:**
- μ¶©λ λ°μƒ μ‹ μ¬μ‹λ„ λ΅μ§ ν•„μ” (ν„μ¬ λ―Έκµ¬ν„)
- μ¶©λμ΄ λΉλ²ν• κ²½μ° μ„±λ¥ μ €ν• κ°€λ¥

**μ°Έκ³  λ¬Έμ„:**
- README.mdμ "λ™μ‹μ„± μ μ–΄" μ„Ήμ… μ°Έμ΅°

---
## π― **μ•„ν‚¤ν…μ² μ„¤κ³„**

### λ””λ ‰ν† λ¦¬ κµ¬μ΅°
```
src/main/java/com/hhplus/be/
β”β”€β”€ {domain}/                    # λ„λ©”μΈλ³„ ν¨ν‚¤μ§€ (cart, product, order, point, user, coupon λ“±)
β”‚   β”β”€β”€ controller/              # Presentation Layer - μ”μ²­/μ‘λ‹µ μ²λ¦¬
β”‚   β”‚   β””β”€β”€ dto/                 # Controllerμ© DTO (*Request, *Response)
β”‚   β”β”€β”€ service/                 # Application Layer - λΉ„μ¦λ‹μ¤ λ΅μ§ μ΅°μ¨
β”‚   β”‚   β””β”€β”€ dto/                 # Serviceμ© DTO (*Command, *Query, *Result)
β”‚   β”β”€β”€ domain/                  # Domain Layer - ν•µμ‹¬ λΉ„μ¦λ‹μ¤ κ·μΉ™
β”‚   β””β”€β”€ infrastructure/          # Infrastructure Layer - λ°μ΄ν„° μ €μ¥μ†
β”‚       β”β”€β”€ {Entity}Repository.java           # Repository μΈν„°νμ΄μ¤
β”‚       β””β”€β”€ InMemory{Entity}Repository.java   # μΈλ©”λ¨λ¦¬ κµ¬ν„μ²΄
β”β”€β”€ common/                      # κ³µν†µ λ¨λ“
β”‚   β”β”€β”€ exception/               # κ³µν†µ μμ™Έ μ²λ¦¬
β”‚   β””β”€β”€ response/                # κ³µν†µ μ‘λ‹µ ν•μ‹
β””β”€β”€ config/                      # μ„¤μ • (Clock λ“±)
```

### μ£Όμ” μ„¤κ³„ κ²°μ •

#### 1. λ„λ©”μΈλ³„ ν¨ν‚¤μ§€ κµ¬μ΅°
**μ„ νƒ μ΄μ :**
- λ„λ©”μΈ μ‘μ§‘λ„ ν–¥μƒ: κ΄€λ ¨ μ½”λ“κ°€ ν• κ³³μ— λ¨μ—¬ μμ–΄ μ΄ν•΄μ™€ μμ • μ©μ΄
- ν™•μ¥μ„±: μƒλ΅μ΄ λ„λ©”μΈ μ¶”κ°€ μ‹ κΈ°μ΅΄ μ½”λ“μ— μν–¥ μµμ†ν™”
- ν€ ν‘μ—…: λ„λ©”μΈλ³„ μ‘μ—… λ¶„λ¦¬κ°€ λ…ν™•

**νΈλ μ΄λ“μ¤ν”„:**
- κ³„μΈµλ³„ κµ¬μ΅° λ€λΉ„ κ³„μΈµ κ°„ μμ΅΄μ„± νμ•… μ–΄λ ¤μ›€
- ν•μ§€λ§ λ„λ©”μΈ ν¬κΈ°κ°€ μ‘μ„ λ•λ” λ” μ§κ΄€μ 

#### 2. Repository μΈν„°νμ΄μ¤ λ¶„λ¦¬
```java
public interface ProductRepository {
    Product save(Product product);
    Optional<Product> findById(Long id);
}

@Repository
public class InMemoryProductRepository implements ProductRepository {
    private final ConcurrentHashMap<Long, Product> store = new ConcurrentHashMap<>();
}
```

**μ„ νƒ μ΄μ :**
- ν…μ¤νΈ μ©μ΄μ„±: Service ν…μ¤νΈ μ‹ Mock μ‚¬μ© κ°€λ¥
- ν–¥ν›„ ν™•μ¥: JPA μ „ν™ μ‹ μΈν„°νμ΄μ¤λ§ μ μ§€
- μμ΅΄μ„± μ—­μ „: Serviceκ°€ κµ¬μ²΄ κµ¬ν„μ— μμ΅΄ν•μ§€ μ•μ

#### 3. DTO λ¶„λ¦¬ (Controller vs Service)
**Controller DTO**: API λ…μ„Έμ™€ 1:1 λ§¤μΉ­ (`*Request`, `*Response`)
**Service DTO**: λΉ„μ¦λ‹μ¤ λ΅μ§ ν‘ν„ (`*Command`, `*Query`, `*Result`)

**μ„ νƒ μ΄μ :**
- κ³„μΈµ κ°„ κ²°ν•©λ„ κ°μ†
- API λ³€κ²½μ΄ Serviceμ— μν–¥ μ—†μ
- ν…μ¤νΈ λ…λ¦½μ„±

**νΈλ μ΄λ“μ¤ν”„:**
- μ½”λ“λ‰ μ¦κ°€ (DTO 2λ°°, λ³€ν™ λ΅μ§ ν•„μ”)
- ν•μ§€λ§ μ¥κΈ°μ  μ μ§€λ³΄μμ„± ν–¥μƒ

#### 4. Clock μ£Όμ…
```java
@Service
public class OrderService {
    private final Clock clock;

    public PaymentResult processPayment(PaymentCommand command) {
        Instant now = Instant.now(clock);  // ν…μ¤νΈ κ°€λ¥
    }
}
```

**μ„ νƒ μ΄μ :**
- μ‹κ°„ μμ΅΄μ  λ΅μ§(λ§λ£, μ ν¨κΈ°κ°„) ν…μ¤νΈ κ°€λ¥
- ν…μ¤νΈμ—μ„ κ³ μ •λ μ‹κ°„ μ£Όμ…

---
## π“ **νκ³ **

### β¨ μν• μ 
- **λ„λ©”μΈλ³„ ν¨ν‚¤μ§€ κµ¬μ΅°**λ΅ μ‘μ§‘λ„ λ†’μ€ μ„¤κ³„
- **Repository μΈν„°νμ΄μ¤ λ¶„λ¦¬**λ΅ ν…μ¤νΈ μ©μ΄μ„± ν™•λ³΄
- **Service λ μ΄μ–΄ λ‹¨μ„ ν…μ¤νΈ** μ¶©μ‹¤ (ν‰κ·  89% μ»¤λ²„λ¦¬μ§€)
- **Clock μ£Όμ…**μΌλ΅ μ‹κ°„ μμ΅΄μ  λ΅μ§ ν…μ¤νΈ κ°€λ¥
- **DTO λ¶„λ¦¬**λ΅ κ³„μΈµ κ°„ κ²°ν•©λ„ κ°μ†

### π“ μ–΄λ ¤μ› λ μ 
- μΈλ©”λ¨λ¦¬ μ €μ¥μ†μ—μ„ λ‚™κ΄€μ  λ½ μ‹λ®¬λ μ΄μ…
- ν†µν•© ν…μ¤νΈ μ—†μ΄ 70% μ»¤λ²„λ¦¬μ§€ λ‹¬μ„± μ–΄λ ¤μ›€ (53% λ‹¬μ„±)
- Controller DTOμ™€ Service DTO λ¶„λ¦¬λ΅ μΈν• μ½”λ“λ‰ μ¦κ°€
- κ²°μ  ν”„λ΅μ„Έμ¤μ λ³µμ΅ν• νΈλμ­μ… μμ„ μ„¤κ³„

### π€ λ‹¤μμ— μ‹λ„ν•  κ²ƒ
- Controller ν†µν•© ν…μ¤νΈ μ¶”κ°€λ΅ 70% μ΄μƒ μ»¤λ²„λ¦¬μ§€ λ‹¬μ„±
- λ™μ‹μ„± ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ μ‘μ„± λ° κ²€μ¦ (STEP 6)
- λ‚™κ΄€μ  λ½ μ¶©λ μ‹ μ¬μ‹λ„ λ΅μ§ κµ¬ν„
- μ‹¤μ  DB(JPA) μ „ν™ μ‹ Repository μΈν„°νμ΄μ¤ μ μ§€ κ²€μ¦

---
## π“ **μ°Έκ³  μλ£**
- [README.md](./README.md) - μƒμ„Έν• μ•„ν‚¤ν…μ² μ„¤κ³„ λ° νΈλ μ΄λ“μ¤ν”„ λ¶„μ„
- [JaCoCo μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬νΈ](./build/reports/jacoco/test/html/index.html)

---
## β‹ **μ²΄ν¬λ¦¬μ¤νΈ (μ μ¶ μ „ ν™•μΈ)**

- [x] DB κ΄€λ ¨ λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•μ§€ μ•μ•λ”κ°€?
- [x] λ¨λ“  Repositoryκ°€ μΈλ©”λ¨λ¦¬λ΅ κµ¬ν„λμ—λ”κ°€?
- [x] package.jsonμ— DB λ“λΌμ΄λ²„κ°€ μ—†λ”κ°€?
- [x] ν™κ²½λ³€μμ— DB μ—°κ²° μ •λ³΄κ°€ μ—†λ”κ°€?